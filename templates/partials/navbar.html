{% load static custom_filters user_tags %}
<nav class="navbar shadow-sm mb-4 px-3" id="main-navbar">
  <div class="container-fluid d-flex align-items-center">

    <!-- Botão do menu lateral (esquerda) -->
    <div class="d-flex align-items-center">
      <button class="btn btn-outline-primary me-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNav" aria-controls="offcanvasNav">
        <i class="bi bi-list fs-4"></i>
      </button>
    </div>

    <!-- Logo + Título (centro) -->
    <div class="position-absolute top-50 start-50 translate-middle">
      <a href="{% url 'dashboard' %}" class="navbar-brand d-flex align-items-center text-decoration-none m-0">
        {% if 'img/chronos-logo.png'|file_exists %}
          <img 
            src="{% static 'img/chronos-logo.png' %}" 
            alt="{{ APP_NAME }} Logo" 
            height="32" 
            class="me-2 d-inline-block align-text-top"
            style="max-width: 150px; height: auto;"
          >
        {% else %}
          <i class="bi bi-clock-history fs-4 text-primary me-2"></i>
        {% endif %}
        <strong class="d-none d-sm-inline">{{ APP_NAME }}</strong>
      </a>
    </div>

    <!-- Botões de Ações (direita) -->
    <div class="d-flex align-items-center ms-auto">
      {% if request.user.is_authenticated %}
        <div class="dropdown me-2">
          <a class="btn btn-outline-secondary dropdown-toggle" href="#" role="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi bi-person-circle me-1"></i>
            <span class="d-none d-md-inline">{{ request.user.get_short_name|default:request.user.username }}</span>
          </a>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
            <li><a class="dropdown-item" href="{% url 'manager:profile' %}"><i class="bi bi-person me-2"></i>Perfil</a></li>
            <li><a class="dropdown-item" href="{% url 'manager:password_change' %}"><i class="bi bi-key me-2"></i>Alterar Senha</a></li>
            <li><hr class="dropdown-divider"></li>
            <li>
              <form method="post" action="{% url 'manager:logout' %}">
                {% csrf_token %}
                <button class="dropdown-item" type="submit">
                  <i class="bi bi-box-arrow-right me-2"></i>Sair
                </button>
              </form>
            </li>
          </ul>
        </div>

        <button id="themeToggle" class="btn btn-outline-secondary" title="Alternar tema">
          <i id="themeIcon" class="bi bi-moon-stars-fill"></i>
        </button>
      {% else %}
        <a class="btn btn-outline-primary" href="{% url 'manager:login' %}">
          <i class="bi bi-box-arrow-in-right me-1"></i> 
          <span class="d-none d-sm-inline">Login</span>
        </a>
      {% endif %}
    </div>
  </div>
</nav>

<!-- Offcanvas Menu -->
{% if request.user.is_authenticated and not request.user|has_group:'client_viewer' %}
  <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasNav" aria-labelledby="offcanvasNavLabel">
    <div class="offcanvas-header border-bottom">
      <h5 id="offcanvasNavLabel" class="text-primary">
        <i class="bi bi-clock-history me-2"></i> {{ APP_NAME }}
      </h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Fechar"></button>
    </div>
    <div class="offcanvas-body">
      <ul class="nav nav-pills flex-column">
        
        <li class="nav-item mb-1">
          <a class="nav-link {% if 'dashboard_executive' in request.resolver_match.url_name %}active{% endif %}" href="{% url 'manager:dashboard_executive' %}">
            <i class="bi bi-graph-up me-2"></i> Dashboard Executivo
          </a>
        </li>

        <li class="nav-item mb-1">
          <a class="nav-link {% if request.resolver_match.namespace == 'clients_suppliers' %}active{% endif %}" href="{% url 'clients_suppliers:party_list' %}">
            <i class="bi bi-building me-2"></i> Clientes
          </a>
        </li>

        <li class="nav-item mb-1">
          <a class="nav-link {% if request.resolver_match.namespace == 'contracts' %}active{% endif %}" href="{% url 'contracts:contract_list' %}">
            <i class="bi bi-file-earmark-text me-2"></i> Contratos
          </a>
        </li>

        <li class="nav-item mb-1">
          <a class="nav-link {% if request.resolver_match.namespace == 'projects' %}active{% endif %}" href="{% url 'projects:project_list' %}">
            <i class="bi bi-diagram-3 me-2"></i> Projetos
          </a>
        </li>

        <li class="nav-item mb-1">
          <a class="nav-link {% if request.resolver_match.namespace == 'tasks' %}active{% endif %}" href="{% url 'tasks:task_list' %}">
            <i class="bi bi-list-task me-2"></i> Tarefas
          </a>
        </li>

        <li class="nav-item mb-1">
          <a class="nav-link {% if 'dashboard_tasks' in request.resolver_match.url_name %}active{% endif %}" href="{% url 'dashboard_tasks' %}">
            <i class="bi bi-kanban me-2"></i> Dashboard Tarefas
          </a>
        </li>
        
        <hr class="my-3">
        
        <li class="nav-item">
          <a class="nav-link {% if 'about_chronos' in request.resolver_match.url_name %}active{% endif %}" href="{% url 'about_chronos' %}">
            <i class="bi bi-info-circle me-2"></i> Sobre o {{ APP_NAME }}
          </a>
        </li>
      </ul>
    </div>
  </div>
{% endif %}